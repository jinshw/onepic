<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>新疆公路建设指挥平台</title>
    <link href="../../static/lib/font-awesome-4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css"
          href="../../static/lib/bootstrap-3.3.7-dist/css/bootstrap.min.css">

    <script type="text/javascript"
            src="../../static/lib/jquery/jquery-3.2.1/jquery-3.2.1.js"></script>
    <script type="text/javascript"
            src="../../static/lib/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <!--zTree-->
    <link rel="stylesheet" href="../../static/lib/zTree-v3/css/zTreeStyle/zTreeStyle.css">
    <link rel="stylesheet" href="../../static/lib/zTree-v3/myZtreeCss.css">
    <script src="../../static/lib/zTree-v3/js/jquery.ztree.all.min.js"></script>
    <script src="../../static/lib/layer-v2.3/layer.js"></script>
    <script src='../../static/lib/supermap/libs/SuperMap.Include.js'></script>
    <style>
        * {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .headerWrap a {
            color: #fff;
        }

        /*.nav>li:hover>a{ background: rgba(0,0,0,.2)}*/
        .nav > li:hover > a {
            color: #0B61A4;
            background: #f5f5f5
        }

        .mianNav {
            position: relative;
        }

        .mianNav p {
            margin: 0;
            display: none;
        }

        .mianNav .caret {
            position: absolute;
            top: 8px;
            right: 15px;
            color: #666;
        }

        .mianNav .dropdown-menu {
            left: 0;
            z-index: 1;
            border: none;
            right: auto
        }

        .mianNav .dropdown-menu li {
            position: relative;
        }

        .mianNav .dropdown-menu a {
            display: inline-block;
            padding: 3px 10px;
            font-size: 12px;
            color: #666
        }

        .mianNav ul li:last-child {
            border-radius: 0 0 4px 4px;
        }

        .mianNav span {
            font-size: 12px;
        }

        /*line bar*/
        .mymap-toolbar-container {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10000;
            background-color: transparent;
        }

        .mymap-toolbar-container .item {
            height: 34px;
            width: 87px;
            padding-left: 14px;
            padding-right: 14px;
            cursor: pointer;
            background-color: #313d4f;
            display: inline-block;
            font-size: 12px;
            line-height: 34px;
            text-align: center;
            white-space: nowrap;
            color: #abacae;
            position: relative;
            float: right;
            box-shadow: 1px 2px 1px rgba(0, 0, 0, .15);
        }

        .mymap-toolbar-container .active {
            color: #ffffff;
        }

        .mymap-toolbar-container .item:hover {
            color: #ffffff;
        }

        .time-bar {
            height: 34px;
            width: 130px;
            padding-left: 14px;
            padding-right: 14px;
            cursor: pointer;
            background-color: #313d4f;
            display: inline-block;
            font-size: 12px;
            line-height: 34px;
            text-align: center;
            white-space: nowrap;
            color: #abacae;
            position: relative;
            float: right;
            box-shadow: 1px 2px 1px rgba(0, 0, 0, .15);
        }

        .angle-left-bt {
            position: absolute;
            left: 0;
            padding: 0 10px;
            top: 3px;
        }

        .angle-right-bt {
            position: absolute;
            right: 0;
            padding: 0 10px;
            top: 3px;
        }

        .angle-left-bt:hover,
        .angle-right-bt:hover {
            color: #ffffff;
        }

        .time-show {
            text-align: center;
            font-size: 12px;
            color: #ffffff;
            position: absolute;
            right: 16px;
        }

        .time-show .date-input {
            background-color: #313d4f;
            border: 0;
            width: 80px;
            height: 34px;
        }

        .time-list {
            position: absolute;
            top: 0px;
            right: 60px;
            z-index: 10000;
            background-color: #313d4f;
            color: #ffffff;
            height: auto;
            width: 172px;
            padding: 10px;
        }

        .jdhc-bar {
            position: absolute;
            top: 0px;
            right: 16px;
            z-index: 10000;
            background-color: #313d4f;
            color: #ffffff;
            height: auto;
            width: 85px;
            padding: 10px;
        }

        /*ztree 个性化定制*/
        .ztree {
            color: #ffffff;
        }

        .ztree li a.level0 span.node_name {
            color: #ffffff;
        }

        .ztree li a {
            color: #ffffff;
        }

        .ztree li span.button.noline_close {
            border-left: 2px solid #fff;
            border-top: 2px solid #fff;
        }

        .ztree li span.button.noline_open {
            border-left: 2px solid #fff;
            border-top: 2px solid #fff;
        }

        .ztree li a.curSelectedNode {
            background: #444f54;
            color: #ffffff;
        }

        /*end ztree*/
        .nav > li > a:focus, .nav > li > a:hover {
            text-decoration: none;
            background-color: #0d75c5;
        }

        .nav > li > a:focus, .nav > li > a:hover {
            color: #FFFFFF;
        }

        #handle {
            position: absolute;
            height: 100%;
            width: 3px;
            left: 50%;
            background: rgb(205, 205, 205);
            border: 1px solid rgb(112, 107, 107);
            z-index: 2000;
            cursor: col-resize;
        }

        #handleCenter {
            position: absolute;
            height: 32px;
            width: 15px;
            top: 50%;
            left: -7px;
            background: rgb(205, 205, 205);
            border: 1px solid rgb(112, 107, 107);
            z-index: 2000;
            /*background-image: url(images/drag.png);*/
            background-position: center;
            background-repeat: no-repeat;
        }

        .yx-time-line {
            width: 100%;
            height: 42px;
            background-color: #313d4f;
            position: absolute;
            top: 0;;
            left: 60px;
            z-index: 9999;
            border-radius: 4px;
        }

        .time-line {
            width: 100%;
            height: 3px;
            background-color: rgb(255, 255, 255);
            position: absolute;
            top: 23px;
            /*display: none;*/
        }

        .time-item {
            /*position: absolute;*/
            /*top:-20px;*/
            float: left;
            margin-right: 10px;
        }

        .dsk-circle {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border: 2px solid rgba(255, 255, 255, 1);
            background: #444;
            border-radius: 50%;
            line-height: 40px;
            text-align: center;
            font-size: 12px;
            color: #fff;
            box-shadow: 0 0 2px rgba(0, 0, 0, .1);
            -webkit-transition: all .5s ease-in;
            -moz-transition: all .5s ease-in;
            -ms-transition: all .5s ease-in;
            -o-transition: all .5s ease-in;
            transition: all .5s ease-in;
            position: relative;
        }

        .active .dsk-circle {
            background-color: #F60;
        }

        .time-line-year {
            float: left;
            margin-right: 11px;
            cursor: pointer;
        }

        .time-line-year-area {
            width: 70px;
            height: 40px;
            color: #fff;
            line-height: 40px;
            font-size: 20px;
            text-align: center;
            margin: 0 auto;
            background-color: #313d4f;
            position: relative;
        }


    </style>
    <script type="text/javascript">
        var infowin = null;
        var map, layerT, layerRoad, layerYXALL, layerZJRoad, layerJSJD, layerJSJDTWD,
                layer20150913, layer20161210, layer20170101, layerGF2016WUYU, layerGJ2017WUYU,
                vectorLayer, layerPublic, layerSar2017, ponitLayer, drawPoint,
//                host = document.location.toString().match(/file:\/\//) ? "http://localhost:8090" : 'http://' + document.location.host;
                host = "http://localhost:8091";
        //        本地测试地址
        url = host + "/iserver/services/map-xjsl3/rest/maps/新疆交通一张图";
        var ROAD_URL = host + "/iserver/services/map-xjsl3/rest/maps/新疆交通道路"
        //        var ZJ_ROAD = host + "/iserver/services/map-zaijiandaolu/rest/maps/GS_1_UTM45_1@test"
        var ZJ_ROAD = host + "/iserver/services/map-zaijiandaolu2/rest/maps/GLZJ"
        var XJ_YX_ALL = host + "/iserver/services/map-11jiyingxiang6102/rest/maps/新疆维吾尔自治区谷歌卫星_170609225420@11jiyingxiang610"
        var YX_2015 = host + "/iserver/services/map-twd20163/rest/maps/GF2_PMS2_E87_9_N43_6_20160620_@tuwuda20161"
        var YX_2016 = host + "/iserver/services/map-twd20162/rest/maps/GF2_PMS2_E87_9_N43_6_20160620_@tuwuda20161"
        var YX_2017 = host + "/iserver/services/map-twd20162/rest/maps/GF2_PMS2_E87_9_N43_6_20160620_@tuwuda20161"
        var JSJD_URL = host + "/iserver/services/map-jsjd/rest/maps/T500@jsjd"
        var JSJD_URL_TWD = host + "/iserver/services/map-jsjdwukui/rest/maps/T500m@jsjdwukui"
        var GF2016_WUYU_URL = host + "/iserver/services/map-G216_GJ/rest/maps/SV1_20170505_L1B0000071309_SV2@G216_GJ_1"
        var GJ2017_WUYU_URL = host + "/iserver/services/map-G216_GJ/rest/maps/SV1_20170505_L1B0000071309_SV2@G216_GJ_1"
        var YX_SL_2017 = host + "/iserver/services/map-yxsx2017/rest/maps/Export_Output_14@yxsx2017"
        var SAR_2017 = host + "/iserver/services/map-G216_GJ/rest/maps/SV1_20170505_L1B0000071309_SV2@G216_GJ_1"

        var DATA_URL = host + "/iserver/services/data-yxsx2017/rest/data"

        //        服务器地址
        //        url = host + "/iserver/services/map-WS_JSJT/rest/maps/JSGIST-GL";
        //        var ROAD_URL = host + "/iserver/services/map-WS_JSJT/rest/maps/JSGIST-GL0"
        //        var ZJ_ROAD = host + "/iserver/services/map-zaijiandaolu/rest/maps/GLZJ"
        //        var XJ_YX_ALL = host + "/iserver/services/map-11jiyingxiang610/rest/maps/新疆影像地图"
        //        var YX_2015 = host + "/iserver/services/map-wukui2015/rest/maps/WK2015@wukui2015"
        //        var YX_2016 = host + "/iserver/services/map-twd2016/rest/maps/GF2_PMS2_E87_9_N43_6_20160620_@tuwuda20161"
        //        var YX_2017 = host + "/iserver/services/map-twd2017/rest/maps/GF2_PMS1_E87_8_N43_6_20170323_@tuwuda20171"
        //        var JSJD_URL = host + "/iserver/services/map-jsjd/rest/maps/T500@jsjd"

        function init() {

            /*
             * 不支持canvas的浏览器不能运行该范例
             * android 设备也不能运行该范例*/
            var broz = SuperMap.Util.getBrowser();

            if (!document.createElement('canvas').getContext) {
                alert('您的浏览器不支持 canvas，请升级');
                return;
            } else if (broz.device === 'android') {
                alert('您的设备不支持，请使用pc或其他设备');
                return;
            }


            document.getElementById('map').style.height = (document.documentElement.clientHeight - 50 ) + 'px'

            var _oneTime = _layerImageList[0].time
            $('#mapTime').val(_oneTime);
            $('#mapTime').data("layerindex", 0)

            ponitLayer = new SuperMap.Layer.Vector("ponitLayer");
            drawPoint = new SuperMap.Control.DrawFeature(ponitLayer, SuperMap.Handler.Point);
            drawPoint.events.on({
                "featureadded": drawCompleted
            });

            //初始化地图
            map = new SuperMap.Map("map", {
                minZoom: 2,
                maxZoom: 18,
                allOverlays: true,
                controls: [
                    new SuperMap.Control.Navigation(),
                    new SuperMap.Control.Zoom(),
                    new SuperMap.Control.LayerSwitcher(),
                    drawPoint
                ]
            });

            //初始化图层
            layerT = new SuperMap.Layer.TiledDynamicRESTLayer("ditu", url, {
                transparent: true,
                cacheEnabled: true
            });


            //监听图层信息加载完成事件
            layerT.events.on({
                "layerInitialized": addLayer1
            });

            // 选择要素
            var callbacks = {
                click: function (currentFeature) {
                    console.log("..............")
                    console.log(currentFeature)
                    var _html = getPopupMsg(currentFeature.attributes)
                    layer.msg(_html);
                    console.log("..............")
                }
            }
            vectorLayer = new SuperMap.Layer.Vector("vectorLayer");
            var selectFeature = new SuperMap.Control.SelectFeature(vectorLayer, {
                callbacks: callbacks
            })
            map.addControl(selectFeature);
            selectFeature.activate();

        }
        // 点控件查询
        function drawCompleted(drawGeometryArgs) {
            var feature = new SuperMap.Feature.Vector();
            feature.geometry = drawGeometryArgs.feature.geometry,
                    feature.style = style;
            ponitLayer.addFeatures(feature);

            var getFeatureParameter, getFeatureService;
            getFeatureParameter = new SuperMap.REST.GetFeaturesByBufferParameters({
                bufferDistance: 30,
                //attributeFilter: "SMID > 0",
                datasetNames: [
                    "yxsx2017:Export_Output", "yxsx2017:Export_Output_2", "yxsx2017:Export_Output_3", "yxsx2017:Export_Output_4",
                    "yxsx2017:Export_Output_5", "yxsx2017:Export_Output_6", "yxsx2017:Export_Output_7", "yxsx2017:Export_Output_8",
                    "yxsx2017:Export_Output_9", "yxsx2017:Export_Output_10", "yxsx2017:Export_Output_11", "yxsx2017:Export_Output_12",
                    "yxsx2017:Export_Output_13", "yxsx2017:Export_Output_14", "yxsx2017:Export_Output_15", "yxsx2017:Export_Output_16",
                    "yxsx2017:Export_Output_17", "yxsx2017:Export_Output_18", "yxsx2017:Export_Output_19", "yxsx2017:Export_Output_20",
                    "yxsx2017:Export_Output_21", "yxsx2017:Export_Output_22"
                ],
                returnContent: true,
                geometry: drawGeometryArgs.feature.geometry
            });
            getFeatureService = new SuperMap.REST.GetFeaturesByBufferService(DATA_URL, {
                eventListeners: {
                    "processCompleted": processCompletedPoint,
                    "processFailed": processFailed
                }
            });
            getFeatureService.processAsync(getFeatureParameter);
        }

        function processCompletedPoint(getFeaturesEventArgs) {
            var _feature = getFeaturesEventArgs.result.features[0]
            if (_feature != undefined) {
                var _attr = _feature.attributes
                var _label = "名称：" + _attr.IMG_NAME + "<br>"
                        + "类型：" + _attr.LEIXING + "<br>"
                        + "拍摄时间：" + _attr.TIME
                layer.msg(_label)
            }
        }


        function removeVectorLayer() {
            vectorLayer.removeAllFeatures();// 去除高亮
        }


        //异步加载图层
        function addLayer() {
            map.addLayers([layerT, layerYXALL, layer20150913, layer20161210, layer20170101,
                layerGF2016WUYU, layerGJ2017WUYU, layerSar2017, layerRoad, layerZJRoad,
                layerJSJD, layerJSJDTWD, ponitLayer, vectorLayer]);

            //显示地图范围9732011.83931, 5440449.31251
            map.setCenter(new SuperMap.LonLat(597829.62986, 4794549.56123), 2.5);

            setLayerVisibility({
                layerT: true,
                layerRoad: false,
                layerYXALL: false,
                layerZJRoad: false,
                layer20150913: false,
                layer20161210: false,
                layer20170101: false,
                vectorLayer: false,
                layerGF2016WUYU: false,
                layerGJ2017WUYU: false,
                layerSar2017: false,
                ponitLayer: false
            })


            useCanvas = layer20150913.useCanvas;
            //获取地图div的宽度
            var mapwidth = map.size.w,
                    handle = document.getElementById("handle");
            //初始化卷帘的位置
            handle.style.left = mapwidth * 0.5 + "px";
            //初始化卷帘图层显示范围
            mapTop = "0px";
            mapButtom = map.size.h + "px";
            mapLeft = "0px";
            mapRightBack = mapwidth * 0.5;
            clip(mapwidth * 0.5);
            //卷帘不支持非Canvas图层，非Canvas图层需要手动实现卷帘
            //监听地图拖动事件
            if (!useCanvas) {
                map.events.on({
                    "movestart": movestart,
                    "move": move
                });
            }

        }

        function addLayer1() {
            layerRoad = new SuperMap.Layer.TiledDynamicRESTLayer("road", ROAD_URL, {
                transparent: true,
                cacheEnabled: true
            });
            layerRoad.events.on({
                "layerInitialized": addLayer2
            });
            // layerRoad.setOpacity(0.5);
        }
        function addLayer2() {
            layerZJRoad = new SuperMap.Layer.TiledDynamicRESTLayer("zjroad", ZJ_ROAD, {
                transparent: true,
                cacheEnabled: true
            });

            layerZJRoad.events.on({
                "layerInitialized": addLayer3
            });
            // layerRoad.setOpacity(0.5);
        }
        function addLayer3() {
            layerYXALL = new SuperMap.Layer.TiledDynamicRESTLayer("yxall", XJ_YX_ALL, {
                transparent: true,
                cacheEnabled: true
            });

            layerYXALL.events.on({
                "layerInitialized": addlayer20150913
            });
        }
        function addlayer20150913() {
            layer20150913 = new SuperMap.Layer.TiledDynamicRESTLayer("20150913", YX_2015, {
                transparent: true,
                cacheEnabled: true
            });

            layer20150913.events.on({
                "layerInitialized": addlayer20161210
            });
        }
        function addlayer20161210() {
            layerPublic = layer20161210 = new SuperMap.Layer.TiledDynamicRESTLayer("20161210", YX_2016, {
                transparent: true,
                cacheEnabled: true
            });

            layer20161210.events.on({
                "layerInitialized": addlayer20170101
            });
        }
        function addlayer20170101() {
            layer20170101 = new SuperMap.Layer.TiledDynamicRESTLayer("20170101", YX_2017, {
                transparent: true,
                cacheEnabled: true
            });

            layer20170101.events.on({
                "layerInitialized": addlayerJSJD
            });
        }
        function addlayerJSJD() {
            layerJSJD = new SuperMap.Layer.TiledDynamicRESTLayer("jsjd", JSJD_URL, {
                transparent: true,
                cacheEnabled: true
            });

            layerJSJD.events.on({
                "layerInitialized": addLayerGF2016WUYU
            });
        }
        function addLayerGF2016WUYU() {
            layerGF2016WUYU = new SuperMap.Layer.TiledDynamicRESTLayer("gf2016wuyu", GF2016_WUYU_URL, {
                transparent: true,
                cacheEnabled: true
            });

            layerGF2016WUYU.events.on({
                "layerInitialized": addLayerGJ2017WUYU
            });
        }
        function addLayerGJ2017WUYU() {
            layerGJ2017WUYU = new SuperMap.Layer.TiledDynamicRESTLayer("gj2017wuyu", GJ2017_WUYU_URL, {
                transparent: true,
                cacheEnabled: true
            });

            layerGJ2017WUYU.events.on({
                "layerInitialized": addLayerSar2017
            });
        }
        function addLayerSar2017() {
            layerSar2017 = new SuperMap.Layer.TiledDynamicRESTLayer("layerSar2017", SAR_2017, {
                transparent: true,
                cacheEnabled: true
            });

            layerSar2017.events.on({
                "layerInitialized": addLayerJSJDTWD
            });
        }
        function addLayerJSJDTWD() {
            layerJSJDTWD = new SuperMap.Layer.TiledDynamicRESTLayer("layerJSJDTWD", JSJD_URL_TWD, {
                transparent: true,
                cacheEnabled: true
            });

            layerJSJDTWD.events.on({
                "layerInitialized": addLayer
            });
        }

        var positionLayer, lat, lon, geolocate, baseLayer, c, b, leftStart = 0,
                topStart = 0,
                leftEnd = 0,
                topEnd = 0,
                mapTop, mapRight, mapButtom, mapLeft,
                useCanvas, mapRightBack, isFirstDrag = false,
                isZoom = false;

        //使图层显示范围随着卷帘的拖动而变化
        function clip(left) {
            mapRight = left + "px";
            //如果在缩放后直接拖动卷帘div，卷帘图层显示范围右侧数值需要进行修正
            if (isZoom && isFirstDrag) {
                mapRight = (left + leftEnd) + "px";
            }
            var rect = "rect(" + mapTop + "," + mapRight + "," + mapButtom + "," + mapLeft + ")";
//            layer20161210.div.style.clip = rect;
            layerPublic.div.style.clip = rect;
        }
        //拖动卷帘
        function drag(e) {
            var objectDiv = document.getElementById("handle");
            //取消事件的默认行为
            e.preventDefault();
            if (document.all) { //鼠标捕获
                objectDiv.setCapture();
            }
            b = e.clientX - parseInt(objectDiv.style.left);
            //鼠标拖动
            document.onmousemove = function (d) {
                if (!d) d = event;
                c = (d.clientX - b);
                //使卷帘在地图内
                if (c > map.size.w - 7) {
                    c = map.size.w - 7;
                }
                if (c < 0) {
                    c = 0;
                }
                if (objectDiv) {
                    objectDiv.style.left = c + "px";
                    //如果使用非Canvas图层，在拖动地图后，再次拖动卷帘div，图层显示范围出错，这里修正图层显示范围右侧数值
                    if (!useCanvas) {
                        mapRightBack = c;
                        c = c - leftEnd;
                        isFirstDrag = true;
                    }
                    clip(c);
                }

            };
            //拖动完成后
            document.onmouseup = function () {
                if (document.all) {
                    //释放鼠标捕获
                    objectDiv.releaseCapture();
                }
                objectDiv = null;

            };
        }
        //地图drag，pan或者zoom操作开始时执行该函数，此时记录卷帘图层显示范围偏移量
        function movestart(evt) {
            var me = this;
            var parsePos = parse(evt.element.childNodes[0].style.left, evt.element.childNodes[0].style.top);
            leftStart = parsePos.left;
            topStart = parsePos.top;
        }
        //地图drag，pan或者zoom操作开始后执行该函数，此时计算卷帘图层显示范围偏移量，如果没有进行缩放，计算偏移量后，设置卷帘图层left，top，right，bottom显示数值
        //如果进行缩放，则left，top，bottom重置为默认值，right设置为当前卷帘div所在位置数值
        function move(evt) {
            var me = this;
            if (!evt.zoomChanged) {
                isZoom = false;
                isFirstDrag = false;
                var parsePos = parse(evt.element.childNodes[0].style.left, evt.element.childNodes[0].style.top);
                leftEnd = parsePos.left;
                topEnd = parsePos.top;
                var dx = -(leftEnd - leftStart);
                var dy = -(topEnd - topStart);
                mapMoveClip(dx, dy);
            } else {
                isZoom = true;
                mapTop = "0px";
                mapRight = mapRightBack + "px";
                mapButtom = map.size.h + "px";
                mapLeft = "0px";
                var rect = "rect(" + mapTop + "," + mapRight + "," + mapButtom + "," + mapLeft + ")";
                layer.div.style.clip = rect;
            }
        }
        //设置非Canvas卷帘图层可见范围
        function mapMoveClip(dx, dy) {
            var posString = layerT.div.style.clip.replace(/rect\(|\)|px/g, "");
            var pos = posString.split(" ");
            mapTop = (parseInt(pos[0]) + dy) + "px";
            mapRight = (parseInt(pos[1]) + dx) + "px";
            mapButtom = (parseInt(pos[2]) + dy) + "px";
            mapLeft = (parseInt(pos[3]) + dx) + "px";
            var rect = "rect(" + mapTop + "," + mapRight + "," + mapButtom + "," + mapLeft + ")";
            layerT.div.style.clip = rect;
            leftStart = leftEnd;
            topStart = topEnd;
        }
        //将传入的数值取整
        function parse(left, top) {
            var left = left,
                    top = top;
            if (left != undefined && top != undefined) {
                left = parseInt(left.replace(/px/g, ""));
                top = parseInt(top.replace(/px/g, ""));
            } else {
                left = 0;
                top = 0;
            }
            return {
                left: left,
                top: top
            };
        }

        function preTimeEvent() {

            var _index = parseInt($('#mapTime').data('layerindex'))
            var _oldObj = _layerImageList[_index]
            changeLayerYXTime(_oldObj.id, false)

            var _tempIndex = _index - 1
            if (_tempIndex < 0) {
                _tempIndex = 0
            }
            var _obj = _layerImageList[_tempIndex]
            $('#mapTime').val(_obj.time);
            $('#mapTime').data('layerindex', _tempIndex)
            changeLayerYXTime(_obj.id, true)
        }

        function nextTimeEvent() {

            var _index = parseInt($('#mapTime').data('layerindex'))
            var _oldObj = _layerImageList[_index]
            changeLayerYXTime(_oldObj.id, false)

            var _tempIndex = _index + 1
            if (_tempIndex >= _layerImageList.length) {
                _tempIndex = _layerImageList.length - 1
            }
            var _obj = _layerImageList[_tempIndex]
            $('#mapTime').val(_obj.time);
            $('#mapTime').data('layerindex', _tempIndex)
            changeLayerYXTime(_obj.id, true)

        }

        function changeLayerYXTime(id, isVisib) {
            if (id == 'layer20150913') {
                layer20150913.setVisibility(isVisib)
                layer20161210.setVisibility(!isVisib)
                layer20170101.setVisibility(!isVisib)
            } else if (id == 'layer20161210') {
                layer20150913.setVisibility(!isVisib)
                layer20161210.setVisibility(isVisib)
                layer20170101.setVisibility(!isVisib)
            } else if (id == 'layer20170101') {
                layer20150913.setVisibility(!isVisib)
                layer20161210.setVisibility(!isVisib)
                layer20170101.setVisibility(isVisib)
            }

        }

        // 图层显示和隐藏
        function clickToolBarBT(e, id) {
            var _classNames = e.className
            if (_classNames.indexOf("active") == -1) { //不包含active
                e.className = 'item active'
                layerChange(id, true)
            } else {
                e.className = 'item'
                layerChange(id, false)
            }

        }
        function layerChange(id, isVisib) {
            if (id == 'yx') {
                layerYXALL.setVisibility(isVisib)

                layerT.setVisibility(!isVisib)
            } else {
                // layerYXALL.setVisibility(false)
                layerT.setVisibility(isVisib)
            }

        }
        //影像切换
        function yxToggle() {
            $("#timeListId").toggle()
        }
        // 查询影像信息
        function queryYXInfo() {
            // 查询影像面数据
            var queryParam, queryParamGS, queryParamGD, queryParamSD, queryBySQLParams, queryBySQLService;
            var queryParam1, queryParam2, queryParam3, queryParam4, queryParam5,
                    queryParam6, queryParam7, queryParam8, queryParam9, queryParam10,
                    queryParam11, queryParam12, queryParam13, queryParam14, queryParam15,
                    queryParam16, queryParam17, queryParam18, queryParam19, queryParam20,
                    queryParam21, queryParam22;
            queryParam1 = new SuperMap.REST.FilterParameter({
                name: "Export_Output@yxsx2017"
            });
            queryParam2 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_19@yxsx2017"
            });
            queryParam3 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_22@yxsx2017"
            });
            queryParam4 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_5@yxsx2017"
            });
            queryParam5 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_3@yxsx2017"
            });
            queryParam6 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_7@yxsx2017"
            });
            queryParam7 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_9@yxsx2017"
            });
            queryParam8 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_11@yxsx2017"
            });
            queryParam9 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_10@yxsx2017"
            });
            queryParam10 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_13@yxsx2017"
            });
            queryParam11 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_12@yxsx2017"
            });
            queryParam12 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_14@yxsx2017"
            });
            queryParam13 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_8@yxsx2017"
            });
            queryParam14 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_6@yxsx2017"
            });
            queryParam15 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_16@yxsx2017"
            });
            queryParam16 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_2@yxsx2017"
            });
            queryParam17 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_4@yxsx2017"
            });
            queryParam18 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_15@yxsx2017"
            });
            queryParam19 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_18@yxsx2017"
            });
            queryParam20 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_17@yxsx2017"
            });
            queryParam21 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_21@yxsx2017"
            });
            queryParam22 = new SuperMap.REST.FilterParameter({
                name: "Export_Output_20@yxsx2017"
            });

            queryBySQLParams = new SuperMap.REST.QueryBySQLParameters({
                queryParams: [
                    queryParam1, queryParam2, queryParam3, queryParam4, queryParam5,
                    queryParam6, queryParam7, queryParam8, queryParam9, queryParam10,
                    queryParam11, queryParam12, queryParam13, queryParam14, queryParam15,
                    queryParam16, queryParam17, queryParam18, queryParam19, queryParam20, queryParam21, queryParam22
                ]
            });
            queryBySQLService = new SuperMap.REST.QueryBySQLService(YX_SL_2017, {
                eventListeners: {
                    "processCompleted": function (queryEventArgs) {
                        console.log(queryEventArgs)
                        var _recordsets = queryEventArgs.result.recordsets
                        var _feature;
                        for (var i = 0; i < _recordsets.length; i++) {
                            _feature = _recordsets[i].features[0]
                            _feature.style = {
                                strokeColor: "#304DBE",
                                strokeWidth: 1,
                                strokeOpacity: "0",
                                fillColor: "#304DBE",
                                fillOpacity: "0"

                            }
                        }

                    },
                    "processFailed": processFailed
                }
            });
            queryBySQLService.processAsync(queryBySQLParams);
        }

        // 基本建设信息查询
        function infoQuery() {
            $('#handle').css('display', 'none');//隐藏卷帘
            $("#leftSider").css("display", "block")
            $("#MainId").removeClass("col-md-12 col-sm-12").addClass("col-md-10 col-sm-10")
            vectorLayer.setVisibility(true)

            setLayerVisibility({
                layerT: true,
                layerRoad: true,
                layerYXALL: false,
                layerZJRoad: true,
                layer20150913: false,
                layer20161210: false,
                layer20170101: false,
                vectorLayer: true
            })

        }

        function changeYXTime(e) {
            var _selectBoxs = $("input[class='yx-time']:checked")
            setLayerVisibility({
                layer20150913: false,
                layer20161210: false,
                layer20170101: false,
                layerGF2016WUYU: false,
                layerGJ2017WUYU: false
            })
            if ($("#box2017").prop("checked")) {
                queryYXInfo();// 查询影像数据
            }

            for (var i = 0; i < _selectBoxs.length; i++) {
                var _selId = $(_selectBoxs[i]).attr("id")
                if (_selId == 'box2015') {
                    layer20150913.setVisibility(true)
                } else if (_selId == 'box2016') {
                    layer20161210.setVisibility(true)
                    layerGF2016WUYU.setVisibility(true)
                } else if (_selId == 'box2017') {
                    layer20170101.setVisibility(true)
                    layerGJ2017WUYU.setVisibility(true)
                } else if (_selId == '2017SAR') {
                    layerSar2017.setVisibility(true)
                }
            }


            if (_selectBoxs.length >= 2) {
                $('#handle').css('display', 'block');//隐藏卷帘
                var _id = $(_selectBoxs[_selectBoxs.length - 1]).attr("id")
                if (_id == "box2015") {
                } else if (_id == "box2016") {
                    layerPublic = layer20161210
                } else if (_id == "box2017") {
                    layerPublic = layer20170101
                } else if (_id == "2017SAR") {
                    layerPublic = layerSar2017
                }


            } else {
                $('#handle').css('display', 'none');//隐藏卷帘
            }
        }
        // 注销点控件
        function deactiveAll() {
            drawPoint.deactivate();
            $("#isScanPicInfo").prop("checked", false);
        }
        // 设置图层显示
        function setLayerVisibility(obj) {

            layerJSJD.setVisibility(false)
            layerJSJDTWD.setVisibility(false)
            layerGF2016WUYU.setVisibility(false)
            layerGJ2017WUYU.setVisibility(false)
            layerSar2017.setVisibility(false)
            ponitLayer.setVisibility(false)

            for (var key in obj) {
                if (key == 'layerT') {
                    layerT.setVisibility(obj[key])
                } else if (key == 'layerRoad') {
                    layerRoad.setVisibility(obj[key])
                } else if (key == 'layerYXALL') {
                    layerYXALL.setVisibility(obj[key])
                } else if (key == 'layerZJRoad') {
                    layerZJRoad.setVisibility(obj[key])
                } else if (key == 'layer20150913') {
                    layer20150913.setVisibility(obj[key])
                } else if (key == 'layer20161210') {
                    layer20161210.setVisibility(obj[key])
                } else if (key == 'layer20170101') {
                    layer20170101.setVisibility(obj[key])
                } else if (key == 'vectorLayer') {
                    vectorLayer.setVisibility(obj[key])
                } else if (key == 'layerJSJD') {
                    layerJSJD.setVisibility(obj[key])
                    layerJSJDTWD.setVisibility(obj[key])
                } else if (key == 'layerGF2016WUYU') {
                    layerGF2016WUYU.setVisibility(obj[key])
                } else if (key == 'layerGJ2017WUYU') {
                    layerGJ2017WUYU.setVisibility(obj[key])
                } else if (key == 'layerSar2017') {
                    layerSar2017.setVisibility(obj[key])
                } else if (key == 'ponitLayer') {
                    ponitLayer.setVisibility(obj[key])
                }
            }
        }

        $(document).ready(function () {

            $("#yxBT").click(function () {
                $("#timeListId").css('display', 'block')
                $('#handle').css('display', 'block')//显示卷帘
                $("#box2015").prop("checked", true);
                $("#box2016").prop("checked", true);
                $("#box2017").prop("checked", false);

                $("#leftSider").css("display", "block")
                $("#MainId").removeClass("col-md-12 col-sm-12").addClass("col-md-10 col-sm-10")
                vectorLayer.removeAllFeatures();// 去除高亮
                vectorLayer.setVisibility(false)

                if ($("#box2017").prop("checked")) {
                    queryYXInfo();// 查询影像数据
                }

                map.setCenter(new SuperMap.LonLat(597829.62986, 4794549.56123), 5);

                setLayerVisibility({
                    layerT: false,
                    layerRoad: true,
                    layerYXALL: true,
                    layerZJRoad: true,
                    layer20150913: true,
                    layer20161210: true,
                    layer20170101: false,
                    vectorLayer: true,
                    layerGF2016WUYU: true,
                    layerGJ2017WUYU: false
                })
            })
            $("#timeListId").mouseleave(function () {
                $("#timeListId").css('display', 'none')
            })
            $("#yxBT").mouseenter(function () {
                $("#timeListId").css('display', 'block')
            })

            //进度审核
            $("#jdhcId").click(function () {
                $("#jdhcCloseBt").prop("checked", true)
                $('#handle').css('display', 'none')//显示卷帘
                $("#leftSider").css("display", "block")
                $("#MainId").removeClass("col-md-12 col-sm-12").addClass("col-md-10 col-sm-10")
                vectorLayer.removeAllFeatures();// 去除高亮
                map.setCenter(new SuperMap.LonLat(520677, 4866758.56123), 7);
                if ($("#box2017").prop("checked")) {
                    queryYXInfo();// 查询影像数据
                }
                setLayerVisibility({
                    layerT: false,
                    layerRoad: true,
                    layerYXALL: true,
                    layerZJRoad: false,
                    layer20150913: false,
                    layer20161210: false,
                    layer20170101: true,
                    vectorLayer: true,
                    layerJSJD: true,
                    layerSar2017: false
                })
            })
            $("#jdhcId").mouseenter(function () {
                $("#jdhcBar").css('display', 'block')
            })
            $("#jdhcBar").mouseleave(function () {
                $("#jdhcBar").css('display', 'none')
            })
            $("#jdhcCloseBt").change(function () {
                if ($("#jdhcCloseBt").prop("checked")) {
                    layerJSJD.setVisibility(true)
                    layerJSJDTWD.setVisibility(true)
                } else {
                    layerJSJD.setVisibility(false)
                    layerJSJDTWD.setVisibility(false)
                }
            })
            $("#isScanPicInfo").change(function () {
                if ($(this).prop("checked")) {
                    drawPoint.activate();
                } else {
                    deactiveAll()
                }
            })

            //点击时间轴
            $(".time-item").click(function () {
                console.log(this)
                $(".time-item").removeClass("active")
                $(this).addClass("time-item active")

            })

            // 点击年
            $(".time-line-year").click(function () {

                var _re = $(".time-line-date").css("display")
                if(_re == undefined || _re == 'block'){
                    $(".time-line-date").css("display","none")
                    $(".yx-time-line").css("width","auto")
                    $(".time-line").hide()
                    $(".time-line-year-area i").removeClass("fa-caret-left")
                    $(".time-line-year-area i").addClass("fa-caret-right")
                }else{
                    $(".time-line-date").css("display","block")
                    $(".yx-time-line").css("width","100%")
                    $(".time-line").show()
                    $(".time-line-year-area i").removeClass("fa-caret-right")
                    $(".time-line-year-area i").addClass("fa-caret-left")
                }
            });
        });
    </script>

</head>
<body class="container-fluid" style="min-width: 1200px; overflow: hidden" onLoad="init()">
<!--header-->
<div class="headerWrap" style="height: 50px; margin: 0 -15px; padding-right:30px; background: #0B61A4;">
    <!--logo-->
    <a class="navbar-brand pl0 mainMenu" href="#">新疆公路建设指挥平台</a>
    <!--导航-->
    <ul class="nav navbar-nav navbar-right my-nav mianNav">
        <li class="dropdown">
            <a href="#" onclick="infoQuery()">基本建设信息查询</span></a>
            <!--

             <ul class="dropdown-menu">
                <li class="js_drop"><a href="#" data-id="asset-roadLine-lxxz"><strong>路线</strong></a>
                    <p>
                        <a href="#" data-id="asset-roadLine-lxxz">路线现状</a>
                        <a href="#" data-id="asset-roadLine-ld">路段</a>
                    </p>
                    <span class="caret"></span>
                </li>
                <li class="js_drop"><a href="#" data-id="asset-subgrade-ljxz"><strong>路基</strong></a>
                    <p>
                        <a href="#" data-id="asset-subgrade-ljxz">路基现状</a>
                        <a href="#" data-id="asset-subgrade-ljfh">路基防护</a>
                        <a href="#" data-id="asset-subgrade-ljps">路基排水</a>
                        <a href="#" data-id="asset-subgrade-ljbp">路基边坡</a>
                    </p>
                    <span class="caret"></span>
                </li>
                <li><a href="#" data-id="asset-roadBed-lm"><strong>路面</strong></a>
                    <a href="#" data-id="asset-bridge-ql"><strong>桥梁</strong></a>
                    <a href="#" data-id="asset-culvert-hd"><strong>涵洞</strong></a>
                    <a href="#" data-id="asset-tollStation-sfz"><strong>收费站</strong></a>
                </li>
            </ul>

            -->

        </li>
        <li class="dropdown">

            <a href="#" id="yxBT">遥感监测</a>
            <!--
<ul class="dropdown-menu">
                <li><a href="#"><strong>GIS分类展示</strong></a></li>
                <li><a href="#"><strong>全路线查询</strong></a></li>
                <li><a href="#"><strong>公里桩号查询</strong></a></li>
            </ul>
            -->

        </li>
        <li class="dropdown">
            <a href="#" id="jdhcId">进度核查</span></a>
            <!--

             <ul class="dropdown-menu">
                <li class="js_drop"><a href="#"><strong>路面巡查</strong></a>
                    <p>
                        <a href="#">路面巡查计划</a>
                        <a href="#">路面巡查记录</a>
                    </p>
                    <span class="caret"></span>
                </li>
                <li class="js_drop"><a href="#"><strong>路基巡查</strong></a>
                    <p>
                        <a href="#">路基巡查计划</a>
                        <a href="#">路基巡查记录</a>
                    </p>
                    <span class="caret"></span>
                </li>
                <li class="js_drop"><a href="#"><strong>桥梁巡查</strong></a>
                    <p>
                        <a href="#">桥梁巡查计划</a>
                        <a href="#">桥梁巡查记录</a>
                    </p>
                    <span class="caret"></span>
                </li>
                <li class="js_drop"><a href="#"><strong>涵洞巡查</strong></a>
                    <p>
                        <a href="#">涵洞巡查计划</a>
                        <a href="#">涵洞巡查记录</a>
                    </p>
                    <span class="caret"></span>
                </li>
            </ul>

            -->


        </li>

    </ul>
</div>
<!--map-->
<div class="row mapWrap">
    <div id="leftSider" class="col-md-2 col-sm-2"
         style="display:none; height: 100%;background: #293033; min-width: 200px">
        <div style="height: 100%; width: 100%; position: absolute; left:10px; overflow: auto;zTreeDemoBackground left">
            <ul id="treeDemo" class="ztree"></ul>
        </div>
    </div>
    <div id="MainId" class="col-md-12 col-sm-12" style="height: 100%; min-width: 880px ">
        <div id="map">
            <div id="handle" title="通过拖动查看图层" onmousedown="drag(event)" style="display: none;">
                <div id="handleCenter"></div>
            </div>
        </div>

        <section class="mymap-toolbar-container" style="display: none">
            <!-- <section class="item active" onclick="clickToolBarBT(this,'sl')">矢量图</section> -->
            <section class="item active" onclick="clickToolBarBT(this,'yx')">卫星影像图</section>
            <!-- <section class="item"
            onclick="clickToolBarBT(this,'d03f8723017342db80c25d8d354845f8')">影像时间轴</section> -->
            <section class="time-bar">
                <section class="angle-left-bt" onclick="preTimeEvent()">
                    <i class="fa fa-angle-left fa-2x" aria-hidden="true"></i>
                </section>
                <section class="time-show">
                    <input type="text" value="" readonly class="form_datetime date-input" id="mapTime">
                    <!-- <span id="mapTime" class="date-input"></span> -->
                </section>
                <section class="angle-right-bt" onclick="nextTimeEvent()">
                    <i class="fa fa-angle-right fa-2x" aria-hidden="true"></i>
                </section>
            </section>
        </section>

        <section class="time-list" id="timeListId" style="display: none;">
            <!--<div class="list-group">-->
            <!--&lt;!&ndash;<a href="#" class="list-group-item active">&ndash;&gt;-->
            <!--&lt;!&ndash;Cras justo odio&ndash;&gt;-->
            <!--&lt;!&ndash;</a>&ndash;&gt;-->
            <!--<a href="#" class="list-group-item">2015影像</a>-->
            <!--<a href="#" class="list-group-item">2016影像</a>-->
            <!--<a href="#" class="list-group-item">2017影像</a>-->
            <!--</div>-->
            <div>
                <input id="box2015" class="yx-time" type="checkbox" onchange="changeYXTime()" checked>2015
            </div>
            <div>
                <input id="box2016" class="yx-time" type="checkbox" onchange="changeYXTime()" checked>2016
            </div>
            <div>
                <input id="box2017" class="yx-time" type="checkbox" onchange="changeYXTime()">2017
            </div>
            <div>
                <input id="2017SAR" class="yx-time" type="checkbox" onchange="changeYXTime()">2017SAR
            </div>
            <div>
                <input id="isScanPicInfo" class="yx-time" type="checkbox">查看影像信息
            </div>

        </section>
        <section class="jdhc-bar" id="jdhcBar" style="display: none;">
            <div>
                <input id="jdhcCloseBt" type="checkbox" checked>开关
            </div>
        </section>
        <div class="yx-time-line" style="display: none;">
            <div class="time-line"></div>
            <div class="time-line-year">
                <div class="time-line-year-area">
                    <i class="fa fa-caret-left" aria-hidden="true"></i>
                    2015
                </div>
            </div>
            <div class="time-line-date">
                <div class="time-item">
                    <div class="dsk-circle">05/10</div>
                </div>
                <div class="time-item">
                    <div class="dsk-circle">05/20</div>
                </div>
                <div class="time-item">
                    <div class="dsk-circle">05/30</div>
                </div>
                <div class="time-item">
                    <div class="dsk-circle">06/10</div>
                </div>
                <div class="time-item">
                    <div class="dsk-circle">06/20</div>
                </div>
                <div class="time-item">
                    <div class="dsk-circle">06/30</div>
                </div>
                <div class="time-item">
                    <div class="dsk-circle">07/10</div>
                </div>
                <div class="time-item">
                    <div class="dsk-circle">07/20</div>
                </div>
                <div class="time-item active">
                    <div class="dsk-circle">07/30</div>
                </div>
                <div class="time-item">
                    <div class="dsk-circle">08/10</div>
                </div>
                <div class="time-item">
                    <div class="dsk-circle">08/20</div>
                </div>
                <div class="time-item">
                    <div class="dsk-circle">08/30</div>
                </div>
                <div class="time-item">
                    <div class="dsk-circle">08/10</div>
                </div>
                <div class="time-item">
                    <div class="dsk-circle">08/20</div>
                </div>
                <div class="time-item">
                    <div class="dsk-circle">08/30</div>
                </div>
                <div class="time-item">
                    <div class="dsk-circle">09/10</div>
                </div>
                <div class="time-item">
                    <div class="dsk-circle">09/20</div>
                </div>
                <div class="time-item">
                    <div class="dsk-circle">09/30</div>
                </div>
            </div>


        </div>

    </div>

</div>

<!--footer-->
<div class="row footerWrap">
    <div class="footer"
         style="height: 280px; display: none; padding-left: 240px; padding-right:10px; position: relative">
        <div style="height: 100%; width: 220px; position: absolute; left:10px; overflow: auto">
            <ul id="treeDemo1" class="ztree"></ul>
        </div>
        <!--<div  style="height: 100%; width:100%">-->
        <!--<iframe id='gridIframe' name="gridIframe" src="asset/roadLine/lxxz.html" frameborder="0" width="100%" height="100%" scrolling="no"></iframe>-->
        <!--</div>-->
    </div>
</div>
<script>
    var zTreeObj;
    var style = {
        strokeColor: "red",
        strokeWidth: 5,
        fillOpacity: "1"
    }
    // zTree 的参数配置，深入使用请参考 API 文档（setting 配置详解）
    var setting = {
        view: {
            showLine: false,
            selectedMulti: false
        },
        data: {
            simpleData: {
                enable: true,
                idKey: "id",
                pIdKey: "pId",
                rootPId: ""
            }
        },
        callback: {
//            beforeClick: beforeClick,
            onClick: onClick
        }
    };
    function onClick(event, treeId, treeNode) {
//        vectorLayer.removeAllFeatures();// 去除高亮
        vectorLayer.setVisibility(true)
        removeVectorLayer()
        deactiveAll();//注销点控件

        var feature;
        if (treeNode.gljb != undefined) {
            var queryParam, queryParamGS, queryParamGD, queryParamSD, queryBySQLParams, queryBySQLService;
            if (treeNode.gljb == 'GS') {
                queryParam = new SuperMap.REST.FilterParameter({
                    name: "高速@交通#3#2"
                });
            } else if (treeNode.gljb == 'GD') {
                queryParam = new SuperMap.REST.FilterParameter({
                    name: "一般国道@交通#2#4",
                    attributeFilter: "SmID = " + treeNode.smId
                });
            } else if (treeNode.gljb == 'SD') {
                queryParam = new SuperMap.REST.FilterParameter({
                    name: "一般省道@交通#3",
                    attributeFilter: "SmID = " + treeNode.smId
                });
            }

            queryBySQLParams = new SuperMap.REST.QueryBySQLParameters({
                queryParams: [queryParam]
            });
            queryBySQLService = new SuperMap.REST.QueryBySQLService(ZJ_ROAD, {
                eventListeners: {
                    "processCompleted": function (queryEventArgs) {
                        console.log("-----------")
//                        console.log(queryEventArgs)
                        console.log("-----------")
                        feature = queryEventArgs.result.recordsets[0].features[0]
                        feature.style = style;
                        vectorLayer.addFeatures(feature);
                        map.zoomToExtent(feature.geometry.getBounds())

                    },
                    "processFailed": processFailed
                }
            });
            queryBySQLService.processAsync(queryBySQLParams);
        }

    }
    vectorLayer = new SuperMap.Layer.Vector("Vector Layer");

    var treeNodes = [
        {id: 1, pId: 0, name: "全部公路", open: true},
        {id: 11, pId: 1, name: "高速"},
        {id: 12, pId: 1, name: "国道"},
        {id: 13, pId: 1, name: "省道"}
    ];

    var gsFeatures = null;
    var gdFeatures = null;
    var sdFeatures = null;

    $(function () {
        function autoHeight() {
            var winH = $(window).height();
            var footerH = $('.footerWrap').height();
            var headerH = $('.headerWrap').height();
            return winH - footerH - headerH;
        }

        $('.mapWrap').height(autoHeight());
        $(window).resize(function () {
            $('.mapWrap').height(autoHeight());
        });


        $('.mianNav>li').hover(function () {
            $(this).find('ul').show().parent().siblings().find('ul').hide();
        }, function () {
            $(this).find('ul').hide();
        });

        $('.js_drop').click(function () {
            $(this).find('p').toggle();
        });


        var queryParamGS, queryParamGD, queryParamSD, queryBySQLParams, queryBySQLService;
        queryParamGS = new SuperMap.REST.FilterParameter({
            name: "高速@交通#3#2"
        });
        queryParamGD = new SuperMap.REST.FilterParameter({
            name: "一般国道@交通#2#4"
        });
        queryParamSD = new SuperMap.REST.FilterParameter({
            name: "一般省道@交通#3"
        });
        queryBySQLParams = new SuperMap.REST.QueryBySQLParameters({
            queryParams: [queryParamGS, queryParamGD, queryParamSD],
            queryOption: "ATTRIBUTE"
        });
        queryBySQLService = new SuperMap.REST.QueryBySQLService(ZJ_ROAD, {
            eventListeners: {
                "processCompleted": processCompleted,
                "processFailed": processFailed
            }
        });
        queryBySQLService.processAsync(queryBySQLParams);

    })


    // 查询数据集处理
    function processCompleted(queryEventArgs) {
        gsFeatures = queryEventArgs.result.recordsets[0].features
        gdFeatures = queryEventArgs.result.recordsets[1].features
        sdFeatures = queryEventArgs.result.recordsets[2].features

        console.log(">>>>>>>>>>>>>>>>>")
//        console.log(gsFeatures)
//        console.log(gdFeatures)
//        console.log(sdFeatures)
        console.log(">>>>>>>>>>>>>>>>>")

        var _obj = null;
        var _count = 0;
        for (var i = 0; i < gsFeatures.length; i++) {
            _obj = gsFeatures[i].attributes
            if (_obj.XMMC == 'G7大黄山至乌鲁木齐段改扩建工程') {
                if (_count == 0) {
                    treeNodes.push({id: i + 2, pId: 11, name: _obj.XMMC, smId: _obj.SmID, gljb: _obj.GLJB, arrIndex: i})
                }
                _count = _count + 1;
            } else {
                treeNodes.push({id: i + 2, pId: 11, name: _obj.XMMC, smId: _obj.SmID, gljb: _obj.GLJB, arrIndex: i})
            }

        }
        for (var i = 0; i < gdFeatures.length; i++) {
            _obj = gdFeatures[i].attributes
            treeNodes.push({id: i + 200, pId: 12, name: _obj.XMMC, smId: _obj.SmID, gljb: _obj.GLJB, arrIndex: i})
        }
        for (var i = 0; i < sdFeatures.length; i++) {
            _obj = sdFeatures[i].attributes
            treeNodes.push({id: i + 300, pId: 13, name: _obj.XMMC, smId: _obj.SmID, gljb: _obj.GLJB, arrIndex: i})
        }
        zTreeObj = $.fn.zTree.init($("#treeDemo"), setting, treeNodes);
    }
    function processFailed(e) {
        alert(e.error.errorMsg);
    }

</script>

<script type="text/javascript">


    /**
     * [获取提示内容]
     * @param  {[type]} obj [properties属性]
     * @return {[type]}     [string]
     */
    function getPopupMsg(obj) {
        var _tempTepl = _markerTepl
        _tempTepl = _tempTepl.replace("##name##", obj.XMMC)
                .replace("##mileage##", parseInt(obj.length))
                .replace("##startTime##", obj.begin_User)
                .replace("##endTime##", obj.end_User)
                .replace("##jianjie##", obj.jianjie)
                .replace("##actual##", obj.mileage)
        return _tempTepl
    }

    // 卫星影像数组
    var _layerImageList = [{
        id: "layer20150913",
        time: "20150913",

    }, {
        id: "layer20161210",
        time: "20161210",
    }, {
        id: "layer20170101",
        time: "20170101",
    }]

    // marker 模板数据
    var _markerTepl = '<div class="popup" style="color: #FFFFFF;font-size: 14px;">  ' +
            '   <section> ' +
            '       公路名：##name##' +
            '   </section>' +
            '   <section> ' +
            '       全长：##mileage##公里' +
            '   </section> ' +
            '   <section>' +
            '       开工时间：##startTime##' +
            '   </section>' +
            '   <section>' +
            '       竣工时间：##endTime##' +
            '   </section>' +
            '   <section>' +
            '       简介：##jianjie##' +
            '   </section>' +
            '   <section>' +
            '</div>'

    // marker数据集
    var _markerList = [{
        "geometry": {
            "type": "Point",
            "coordinates": [
                623865.51010, 4772555.12113
            ]
        },
        "properties": {
            "name": "G30小草湖至乌鲁木齐段改扩建工程",
            "mileage": "380",
            "design": "中交XXXX",
            "plan": "5",
            "actual": "6"
        }
    }, {
        "geometry": {
            "type": "Point",
            "coordinates": [
                622867.43265, 4774969.16099
            ]
        },
        "properties": {
            "name": "G30小草湖至乌鲁木齐段改扩建工程",
            "mileage": "381",
            "design": "中交XXXX",
            "plan": "5",
            "actual": "6"
        }
    }, {
        "geometry": {
            "type": "Point",
            "coordinates": [
                620879.68869, 4779458.34025
            ]
        },
        "properties": {
            "name": "G30小草湖至乌鲁木齐段改扩建工程",
            "mileage": "382",
            "design": "中交XXXX",
            "plan": "5",
            "actual": "6"
        }
    }, {
        "geometry": {
            "type": "Point",
            "coordinates": [
                614764.72642, 4787675.32079
            ]
        },
        "properties": {
            "name": "G30小草湖至乌鲁木齐段改扩建工程",
            "mileage": "383",
            "design": "中交XXXX",
            "plan": "5",
            "actual": "6"
        }
    }, {
        "geometry": {
            "type": "Point",
            "coordinates": [
                609223.04187, 4793446.31642
            ]
        },
        "properties": {
            "name": "G30小草湖至乌鲁木齐段改扩建工程",
            "mileage": "384",
            "design": "中交XXXX",
            "plan": "5",
            "actual": "6"
        }
    }]
</script>
</body>
</html>